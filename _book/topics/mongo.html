<!DOCTYPE HTML>
<html lang="en" >
    <!-- Start book  -->
    <head>
        <!-- head:start -->
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Mongo DB Setup | </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.7">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-splitter/splitter.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="../topics/network.html" />
    
    
    <link rel="prev" href="../topics/database/hibernate.html" />
    

        <!-- head:end -->
    </head>
    <body>
        <!-- body:start -->
        
    <div class="book"
        data-level="6"
        data-chapter-title="Mongo DB Setup"
        data-filepath="topics/mongo.adoc"
        data-basepath=".."
        data-revision="Tue May 10 2016 12:48:11 GMT+0530 (IST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="topics/overview.html">
            
                
                    <a href="../topics/overview.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Overview
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="topics/overview/recommended-reading.html">
            
                
                    <a href="../topics/overview/recommended-reading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Recommended Reading
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="topics/installation.html">
            
                
                    <a href="../topics/installation.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Installation
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="topics/installation/system-requirements.html">
            
                
                    <a href="../topics/installation/system-requirements.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        System Requirements
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="topics/installation/distribution-files-community.html">
            
                
                    <a href="../topics/installation/distribution-files-community.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        Installing Distribution Files
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="topics/installation/directory-structure.html">
            
                
                    <a href="../topics/installation/directory-structure.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Distribution Directory Structure
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3" data-path="topics/operating-mode.html">
            
                
                    <a href="../topics/operating-mode.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Choosing an Operating Mode
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1" data-path="topics/operating-mode/standalone.html">
            
                
                    <a href="../topics/operating-mode/standalone.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                        Standalone Mode
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="topics/operating-mode/standalone-ha.html">
            
                
                    <a href="../topics/operating-mode/standalone-ha.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                        Standalone Clustered Mode
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="topics/operating-mode/domain.html">
            
                
                    <a href="../topics/operating-mode/domain.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                        Domain Clustered Mode
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4" data-path="topics/manage.html">
            
                
                    <a href="../topics/manage.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Managing Config at Runtime
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="topics/database.html">
            
                
                    <a href="../topics/database.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Relational Database Setup
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1" data-path="topics/database/checklist.html">
            
                
                    <a href="../topics/database/checklist.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                        Setup Checklist
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="topics/database/jdbc.html">
            
                
                    <a href="../topics/database/jdbc.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                        JDBC Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="topics/database/datasource.html">
            
                
                    <a href="../topics/database/datasource.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                        Datasource Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="topics/database/hibernate.html">
            
                
                    <a href="../topics/database/hibernate.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                        Hibernate Configuration
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="6" data-path="topics/mongo.html">
            
                
                    <a href="../topics/mongo.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Mongo DB Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="topics/network.html">
            
                
                    <a href="../topics/network.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Network Setup
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="topics/network/bind-address.html">
            
                
                    <a href="../topics/network/bind-address.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        Bind Addresses
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="topics/network/ports.html">
            
                
                    <a href="../topics/network/ports.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.2.</b>
                        
                        Socket Port Bindings
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.3" data-path="topics/network/https.html">
            
                
                    <a href="../topics/network/https.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.3.</b>
                        
                        HTTPS/SSL Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7.4" data-path="topics/network/outgoing.html">
            
                
                    <a href="../topics/network/outgoing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.4.</b>
                        
                        Outgoing HTTP Requests
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="topics/clustering.html">
            
                
                    <a href="../topics/clustering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Clustering
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="8.1" data-path="topics/clustering/recommended.html">
            
                
                    <a href="../topics/clustering/recommended.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.1.</b>
                        
                        Recommended Network Architecture
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.2" data-path="topics/clustering/example.html">
            
                
                    <a href="../topics/clustering/example.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.2.</b>
                        
                        Cluster Example
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.3" data-path="topics/clustering/load-balancer.html">
            
                
                    <a href="../topics/clustering/load-balancer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.3.</b>
                        
                        Setting Up a Load Balancer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.4" data-path="topics/clustering/multicast.html">
            
                
                    <a href="../topics/clustering/multicast.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.4.</b>
                        
                        Multicast Network Setup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.5" data-path="topics/clustering/serialized.html">
            
                
                    <a href="../topics/clustering/serialized.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.5.</b>
                        
                        Serialized Cluster Startup
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.6" data-path="topics/clustering/booting.html">
            
                
                    <a href="../topics/clustering/booting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.6.</b>
                        
                        Booting the Cluster
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8.7" data-path="topics/clustering/troubleshooting.html">
            
                
                    <a href="../topics/clustering/troubleshooting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.7.</b>
                        
                        Trouble Shooting
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="9" data-path="topics/cache.html">
            
                
                    <a href="../topics/cache.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Server Cache Configuration
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="topics/cache/eviction.html">
            
                
                    <a href="../topics/cache/eviction.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Eviction Policy and Max Entries
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="topics/cache/replication.html">
            
                
                    <a href="../topics/cache/replication.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Replication and Failover
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.3" data-path="topics/cache/disable.html">
            
                
                    <a href="../topics/cache/disable.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.3.</b>
                        
                        Disabling Caching
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.4" data-path="topics/cache/clear.html">
            
                
                    <a href="../topics/cache/clear.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.4.</b>
                        
                        Clearing Caches at Runtime
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="topics/proxy.html">
            
                
                    <a href="../topics/proxy.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Keycloak Security Proxy
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" ></a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <div class="sect1">
<h2 id="_mongo">Mongo DB Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You are not stuck with using a RDBMS for persisting data.  Keycloak
provides a <a href="http://www.mongodb.com" target="_blank">MongoDB</a> based model implementation.
To configure Keycloak to use Mongo, you need to edit the <em>keycloak-server.json</em> file.  If you are running
in standalone mode, this file is in the <em>&#x2026;&#x200B;/standalone/configuration</em> directory.  If you are running in domain mode
this file will live in the <em>&#x2026;&#x200B;/domain/servers/{server name}/configuration</em> directory.</p>
</div>
<div class="paragraph">
<p>Open the <em>keycloak-server.json</em> file.  Look for the following JSON snippet  This is the area you will be modifying
to use Mongo.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"><span class="hljs-string">&quot;eventsStore&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;jpa&quot;</span>,
    <span class="hljs-string">&quot;jpa&quot;</span>: {
        <span class="hljs-string">&quot;exclude-events&quot;</span>: [ <span class="hljs-string">&quot;REFRESH_TOKEN&quot;</span> ]
    }
},

<span class="hljs-string">&quot;realm&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;jpa&quot;</span>
},

<span class="hljs-string">&quot;user&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;${keycloak.user.provider:jpa}&quot;</span>
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>Change that JSON snippet to use Mongo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"><span class="hljs-string">&quot;eventsStore&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;mongo&quot;</span>,
    <span class="hljs-string">&quot;mongo&quot;</span>: {
        <span class="hljs-string">&quot;exclude-events&quot;</span>: [ <span class="hljs-string">&quot;REFRESH_TOKEN&quot;</span> ]
    }
},

<span class="hljs-string">&quot;realm&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;mongo&quot;</span>
},

<span class="hljs-string">&quot;user&quot;</span>: {
    <span class="hljs-string">&quot;provider&quot;</span>: <span class="hljs-string">&quot;mongo&quot;</span>
},</code></pre>
</div>
</div>
<div class="paragraph">
<p>And at the end of the file add the snippet like this where you can configure details about your Mongo database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json"><span class="hljs-string">&quot;connectionsMongo&quot;</span>: {
    <span class="hljs-string">&quot;default&quot;</span>: {
        <span class="hljs-string">&quot;host&quot;</span>: <span class="hljs-string">&quot;127.0.0.1&quot;</span>,
        <span class="hljs-string">&quot;port&quot;</span>: <span class="hljs-string">&quot;27017&quot;</span>,
        <span class="hljs-string">&quot;db&quot;</span>: <span class="hljs-string">&quot;keycloak&quot;</span>,
        <span class="hljs-string">&quot;connectionsPerHost&quot;</span>: <span class="hljs-number">100</span>,
        <span class="hljs-string">&quot;databaseSchema&quot;</span>: <span class="hljs-string">&quot;update&quot;</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All configuration options are optional.
Default values for host and port are localhost and 27017.
Default name of database is <code>keycloak</code> . You can also specify properties <code>user</code> and <code>password</code> if you want authenticate against your MongoDB.
If user and password are not specified, Keycloak will connect unauthenticated to your MongoDB.</p>
</div>
<div class="paragraph">
<p>Finally there is set of optional configuration options, which can be used to specify connection-pooling capabilities of Mongo client.
Supported int options are: <code>connectionsPerHost</code>, <code>threadsAllowedToBlockForConnectionMultiplier</code>, <code>maxWaitTime</code>, <code>connectTimeout</code> <code>socketTimeout</code>.
Supported boolean options are: <code>socketKeepAlive</code>, <code>autoConnectRetry</code>.
Supported long option is <code>maxAutoConnectRetryTime</code>.
See <a href="http://api.mongodb.org/java/2.11.4/com/mongodb/MongoClientOptions.html" target="_blank">Mongo documentation</a>                for details about those options and their default values.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can configure MongoDB using a MongoDB <a href="http://docs.mongodb.org/manual/reference/connection-string/" target="_blank">connection URI</a>.
In this case, you define all information concerning the connection and authentication within the URI, as described in the MongoDB documentation.
Please note that the database specified within the URI is only used for authentication.
To change the database used by Keycloak you have to set <code>db</code> property as before.
Therefore, a configuration like the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&quot;connectionsMongo&quot;: {
    &quot;default&quot;: {
        &quot;uri&quot;: &quot;mongodb://user:password@127.0.0.1/authentication&quot;,
        &quot;db&quot;: &quot;keycloak&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>will authenticate the user against the authentication database, but store all Keycloak related data in the keycloak database.</p>
</div>
<div class="sect2">
<h3 id="_mongodb_replica_sets">MongoDB Replica Sets</h3>
<div class="paragraph">
<p>In order to use a mongo replica set for Keycloak, one has to use URI based configuration, which supports the definition of replica sets out of the box: <code>mongodb://host1:27017,host2:27017,host3:27017/</code>.</p>
</div>
</div>
</div>
</div>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../topics/database/hibernate.html" class="navigation navigation-prev " aria-label="Previous page: Hibernate Configuration"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../topics/network.html" class="navigation navigation-next " aria-label="Next page: Network Setup"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-toggle-chapters/toggle.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-ungrey/ungrey.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-splitter/splitter.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"toggle-chapters":{},"ungrey":{},"splitter":{},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"livereload":{}};
    gitbook.start(config);
});
</script>

        <!-- body:end -->
    </body>
    <!-- End of book  -->
</html>
